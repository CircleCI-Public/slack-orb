description: |
  Insert this job in-line with your standard CircleCI on-hold notification jobs to simulataniously send a Slack notification containing a link to the paused Workflow.

parameters:
  branch_pattern:
    description: |
      A comma separated list of regex matchable branch names.
      Notifications will only be sent if sent from a job from these branches.
      By default ".+" will be used to match all branches. Pattern must be a POSIX expression and match the full string, no partial matches.
    type: string
    default: ".+"
  invert_match:
    description: |
      Invert the branch and tag patterns.
      If set to true, notifications will only be sent if sent from a job from branches and tags that do not match the patterns.
    type: boolean
    default: false
  mentions:
    description: |
      Exports to the "$SLACK_STR_MENTIONS" environment variable for use in templates.
      Mention users via the @ symbol: "@USER"
      If the username contains a space, the Slack ID must be used with angled brackets: "<@U8XXXXXXX>"
    type: string
    default: ""
  template_var:
    description: |
      Provide an environment variable containing a custom template to use for the notification.
      This parameter takes precedence over the "template_path", "template_inline", and "template" parameters.
    type: string
    default: ""
  template_path:
    description: |
      Provide a path to a custom template to use for the notification.
      The path must be relative to the root of the repository.
      This parameter takes precedence over the "template_inline" and "template" parameters.
    type: string
    default: ""
  template_inline:
    description: |
      Provide an inline custom template to use for the notification.
      This parameter takes precedence over the "template" parameter.
    type: string
    default: ""
  template:
    description: |
      Pick a pre-built template to use for the notification.
      This parameter is ignored if the "template_inline", "template_path", or "template_var" parameters are set.
      If left blank, the template will be inferred from the job status.
    type: enum
    enum: ["basic_fail_1", "basic_on_hold_1", "basic_success_1", "success_tagged_deploy_1", ""]
    default: ""
  channel:
      description: |
        Select which channel in which to post to. Channel name or ID will work. You may include a comma separated list of channels if you wish to post to multiple channels at once. Set the "SLACK_DEFAULT_CHANNEL" environment variable for the default channel.
      type: string
      default: $SLACK_DEFAULT_CHANNEL
  debug:
      description: |
       View payload and response being sent to slack api.
       Enable to view full payload being sent to slack and response being received from the API call.
      type: boolean
      default: false
  circleci_host:
      description: |
       CircleCI Host (used as the base for the Workflow URL)
      type: string
      default: https://circleci.com
  step_name:
    type: string
    default: Slack - Sending Notification
    description: Specify a custom step name for this command, if desired

docker:
  - image: cimg/base:stable
resource_class: small

steps:
  - notify:
      event: always
      template_var: "<<parameters.template_var>>"
      template_path: "<<parameters.template_path>>"
      template_inline: "<<parameters.template_inline>>"
      template: "<<parameters.template>>"
      branch_pattern: <<parameters.branch_pattern>>
      invert_match: <<parameters.invert_match>>
      mentions: <<parameters.mentions>>
      channel: <<parameters.channel>>
      debug: <<parameters.debug>>
      circleci_host: <<parameters.circleci_host>>
      step_name: <<parameters.step_name>>
